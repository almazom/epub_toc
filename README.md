# EPUB TOC Parser

Модуль для извлечения оглавления из EPUB файлов с поддержкой иерархической структуры.

## Особенности
- Поддержка нескольких методов извлечения (NCX, epub_meta, OPF)
- Автоматический выбор лучшего метода
- Сохранение иерархической структуры оглавления
- Поддержка русского и английского языков
- Сохранение результатов в JSON формат
- Подробное логирование процесса
- Генерация отчетов анализа EPUB файлов

## Установка

```bash
pip install -r requirements.txt
```

## Использование

### Как модуль

```python
from epub_toc_parser import EPUBTOCParser

# Создаем парсер
parser = EPUBTOCParser('path/to/book.epub')

# Извлекаем оглавление
toc = parser.extract_toc()

# Выводим в консоль
parser.print_toc()

# Сохраняем в JSON
parser.save_toc_to_json('output.json')
```

### Из командной строки

```bash
python epub_toc_parser.py path/to/book.epub
```

### Анализ EPUB файлов

Для анализа всех EPUB файлов в директории tests/data/epub_samples:

```bash
python tests/integration/test_epub_analysis.py
```

Результаты анализа сохраняются в директории `reports/`:
- `epub_analysis_YYYYMMDD_HHMMSS.json` - подробный отчет в JSON формате
- `epub_analysis_YYYYMMDD_HHMMSS.txt` - краткий отчет в текстовом формате
- `toc/*.json` - извлеченные оглавления для каждого EPUB файла

Структура отчетов:
1. JSON отчет содержит:
   - Общую статистику по всем файлам
   - Успешность методов извлечения
   - Подробные результаты по каждому файлу
   - Ссылки на файлы с извлеченными TOC

2. Текстовый отчет включает:
   - Краткую статистику
   - Информацию о каждом файле
   - Пути к извлеченным TOC

3. TOC файлы:
   - Сохраняются в подпапке `toc/`
   - Именуются как `имя_книги_toc.json`
   - Содержат полное оглавление в JSON формате

## Формат вывода

Оглавление сохраняется в JSON формате со следующей структурой:

```json
[
  {
    "title": "Глава 1",
    "href": "chapter1.html",
    "level": 0,
    "children": [
      {
        "title": "Подраздел 1.1",
        "href": "chapter1.html#section1",
        "level": 1,
        "children": []
      }
    ]
  }
]
```

## Тестирование

Модуль успешно протестирован на различных EPUB файлах:
- Русскоязычные книги (NCX метод)
- Англоязычные книги (epub_meta метод)
- Файлы с разной структурой оглавления
- Файлы разного размера (от 400KB до 8MB)

## Требования
- Python 3.7+
- epub_meta>=0.0.7
- lxml>=4.9.3
- beautifulsoup4>=4.12.2 